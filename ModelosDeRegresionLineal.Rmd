---
title: "ModelosDeRegresionLineal"
author: "Cristopher Barrios, Carlos Daniel Estrada"
date: "2023-03-06"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(haven)
library(rpart)
library(stats)
library(dplyr)
library(cluster)
library(rpart.plot)
library(fpc)
library(ggplot2)
library(tidyverse)
library(e1071)

#train <- read.csv("train.csv")
#test <- read.csv("test.csv")

```

### 1. Descargue los conjuntos de datos de la plataforma kaggle.
librerías
```{r}
datos = read.csv("./train.csv")
test<- read.csv("./test.csv", stringsAsFactors = FALSE)

#Columnas
house <-select(datos, LotFrontage, LotArea, YearBuilt, YearRemodAdd, MasVnrArea, BsmtFinSF1,BsmtFinSF2,BsmtUnfSF,TotalBsmtSF,X1stFlrSF,X2ndFlrSF,LowQualFinSF,GrLivArea,TotRmsAbvGrd,Fireplaces,GarageYrBlt,GarageCars,GarageArea,WoodDeckSF,OpenPorchSF,EnclosedPorch,ScreenPorch,PoolArea,MoSold,YrSold,SalePrice)

#Data
house <- na.omit(house)

# Resumen 
summary(house)
```

### 2. Haga un análisis exploratorio extenso de los datos. Explique bien todos los hallazgos. No ponga solo gráficas y código. Debe llegar a conclusiones interesantes para poder predecir. Explique el preprocesamiento que necesitó hacer.

Analisis exploratorio

---Exploración rápida de datos---
train
```{r}
summary(datos)
```
test
```{r}
summary(test)

```


```{r}
NombreDeLaVariables <- c("SalePrice", "MSSubClass", "MSZoning", "LotFrontage", "LotArea", "Street", "Alley", "LotShape", "LandContour", "Utilities", "LotConfig", "LandSlope", "Neighborhood", "Condition1", "Condition2", "BldgType", "HouseStyle", "OverallQual", "OverallCond", "YearBuilt", "YearBuilt", "RoofStyle", "RoofMatl", "Exterior1st", "Exterior2nd", "MasVnrType", "MasVnrArea","ExterQual","ExterCond","Foundation","BsmtQual","BsmtCond","BsmtExposure","BsmtFinType1","BsmtFinSF1","BsmtFinType2","BsmtFinSF2","BsmtUnfSF","TotalBsmtSF","Heating","HeatingQC","CentralAir","Electrical","1stFlrSF","2ndFlrSF","LowQualFinSF","GrLivArea","BsmtFullBath","BsmtHalfBath","FullBath","HalfBath","Bedroom","Kitchen","KitchenQual","TotRmsAbvGrd","Functional","Fireplaces","FireplaceQu","GarageType","GarageYrBlt","GarageFinish","GarageCars","GarageArea","GarageQual","GarageCond","PavedDrive","WoodDeckSF","OpenPorchSF","EnclosedPorch","3SsnPorch","ScreenPorch","PoolArea","PoolQC","Fence","MiscFeature","MiscVal","MoSold","YrSold","SaleType","SaleCondition")

Cualitativa <- c("", "", "x", "", "", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "x", "", "", "", "", "x", "x", "x", "x", "x", "", "x", "x", "x", "x", "x", "x", "x", "", "x", "", "", "", "x", "x", "x", "x", "", "", "", "", "", "", "f", "", "", "", "x", "", "x", "", "x", "x", "", "x", "", "", "x", "x", "x", "", "", "", "", "", "", "x", "x", "x", "", "", "", "x", "x")
Cuantitativa <- c("x", "x", "", "x", "x", "", "", "", "", "", "", "", "", "", "", "", "", "x", "x", "x", "x", "", "", "", "", "", "x", "", "", "", "", "", "", "", "x", "", "x", "x", "x", "", "", "", "", "x", "x", "x", "x", "x", "x", "xf", "x", "x", "x", "", "x", "", "x", "", "", "x", "", "x", "x", "", "", "", "x", "x", "x", "x", "x", "x", "", "", "", "x", "x", "x", "", "")

Discreta <- c("", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "x", "x", "xf", "x", "x", "x", "", "x", "", "x", "", "", "", "", "x", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "")
Continua <- c("x", "x", "", "x", "x", "", "", "", "", "", "", "", "", "", "", "", "", "x", "x", "x", "x", "", "", "", "", "", "x", "", "", "", "", "", "", "", "x", "", "x", "x", "x", "", "", "", "", "x", "x", "x", "x", "", "", "f", "", "", "", "", "", "", "", "", "", "x", "", "", "x", "", "", "", "x", "x", "x", "x", "x", "x", "", "", "", "x", "x", "x", "", "")



DataFrame.NombreDeLaVariables <- data.frame(NombreDeLaVariables, Cualitativa,Cuantitativa,Discreta,Continua)

print(DataFrame.NombreDeLaVariables)

```

Estilo de vivienda

```{r}
totalGenres <- unlist(strsplit(as.character(datos$BldgType), "\\|"))
barplot(table(totalGenres))
```
La mayorías de las casas son para una familia

```{r}
totalGenres <- unlist(strsplit(as.character(datos$HouseStyle), "\\|"))
barplot(table(totalGenres))
```
El estilo más común de casa es de 1 solo nivel, por lo que podemos deducir que las casas de 2 niveles son más cotizadas


Año de construcción 

```{r}
totalGenres <- unlist(strsplit(as.character(datos$YearBuilt), "\\|"))
barplot(table(totalGenres))
```
La mayoría de las casas fueron construidas en los años 2000

Casas mas nuevas: 
```{r}
newhouses <- head(order(datos$YearBuilt, decreasing = T), n=10)
datos[newhouses,c("Id","YearBuilt","SalePrice")]
```


Año de remodelación
```{r}
totalGenres <- unlist(strsplit(as.character(datos$YearRemodAdd), "\\|"))
barplot(table(totalGenres))
```
La mayoría de las casas no han sido remodeladas desde la decada de los 50s

Casas recientementes remodeladas: 
```{r}
newhouses <- head(order(datos$YearRemodAdd, decreasing = T), n=10)
datos[newhouses,c("Id","YearRemodAdd", "SalePrice")]
```


Cantidad de habitaciones 

```{r}
totalGenres <- unlist(strsplit(as.character(datos$TotRmsAbvGrd), "\\|"))
barplot(table(totalGenres))
```
La mayoría de las casast tienen solo 6 habitaciones 
```{r}
newhouses <- head(order(datos$TotRmsAbvGrd, decreasing = T), n=10)
datos[newhouses,c("Id","TotRmsAbvGrd","SalePrice")]
```

cantidad de baños 

```{r}
totalGenres <- unlist(strsplit(as.character(datos$FullBath), "\\|"))
barplot(table(totalGenres))
```
Las casas familiares tienen entre 1 y 2 baños 


cantidad de cocinas 

```{r}
totalGenres <- unlist(strsplit(as.character(datos$KitchenAbvGr), "\\|"))
barplot(table(totalGenres))
```
LAs casas por lo general tienen solo una cocina

capacidad de garages

```{r}
totalGenres <- unlist(strsplit(as.character(datos$GarageCars), "\\|"))
barplot(table(totalGenres))
```

La mayoría de las casas estan adecuadas para estacionar 2 autos 



### 3. Incluya un análisis de grupos en el análisis exploratorio. Explique las características de los grupos.
```{r}
# con k-medias
cluster <- house
km<-kmeans(house,3)
house$grupo<-km$cluster
plotcluster(cluster,km$cluster) # los cluster
```

```{r}
#método de la silueta
silkm<-silhouette(km$cluster,dist(house))
mean(silkm[,3]) #Silueta 
```

```{r}
g1<- house[house$grupo==1,]
prop.table(table(g1$Species))*100

```

```{r}
g2<- house[house$grupo==2,]
prop.table(table(g2$Species))*100
```

```{r}
g3<- house[house$grupo==3,]
prop.table(table(g3$Species))*100
```

```{r}
summary(g1)
```

```{r}
summary(g2)
```

```{r}
summary(g3)
```

--- prueba 1 ---
```{r}
##Similitud en las variables independientes y los precios de venta:
cor(house$YearBuilt, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$YearRemodAdd, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$TotalBsmtSF, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$X1stFlrSF, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GrLivArea, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$TotRmsAbvGrd, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GarageCars, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GarageArea, house$SalePrice, method = c("pearson", "kendall", "spearman"))

```

```{r}
#Columnas
house <-select(datos,TotalBsmtSF,X1stFlrSF,GrLivArea,GarageCars,GarageArea,SalePrice)

#limpiamos
house <- na.omit(house)

#k-medias
cluster <- house
km<-kmeans(house,3)
house$grupo<-km$cluster
plotcluster(cluster,km$cluster) #graficamos ubicacion de cluster
```

```{r}
#Silueta
silkm<-silhouette(km$cluster,dist(house))
mean(silkm[,3])
```

--- prueba 2 ---
```{r}
cor(house$TotalBsmtSF, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$X1stFlrSF, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GrLivArea, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GarageCars, house$SalePrice, method = c("pearson", "kendall", "spearman"))
cor(house$GarageArea, house$SalePrice, method = c("pearson", "kendall", "spearman"))
```

```{r}
#Columnas
house <-select(datos,TotalBsmtSF,X1stFlrSF,GrLivArea,GarageCars,GarageArea,SalePrice)

#limpiamos
house <- na.omit(house)

#k-medias
cluster <- house
km<-kmeans(house,3)
house$grupo<-km$cluster
plotcluster(cluster,km$cluster) #Graficamos clusters
```

```{r}
#silueta
silkm<-silhouette(km$cluster,dist(house))
mean(silkm[,3])
```

### 4. Divida el set de datos preprocesados en dos conjuntos: Entrenamiento y prueba. Describa el criterio que usó para crear los conjuntos: número de filas de cada uno, estratificado o no, balanceado o no, etc. Si le proveen un conjunto de datos de prueba y tiene suficientes datos, tómelo como de validación, pero haga sus propios conjuntos de prueba.

### 5. Haga ingeniería de características, ¿qué variables cree que puedan ser mejores predictores para el precio de las casas? Explique en que basó la selección o no de las variables.

### 6. Todos los resultados deben ser reproducible por lo que debe fijar que los conjuntos de entrenamiento y prueba sean los mismos siempre que se ejecute el código.

### 7. Seleccione una de las variables y haga un modelo univariado de regresión lineal para predecir el precio de las casas. Analice el modelo 